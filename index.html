<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Durga Puja Club Dashboard</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<style>
body { font-family: Arial; background: #fff5f0; color: #4b2e2e; margin: 0; padding: 0; }
header { background: #b71c1c; color: white; padding: 15px; text-align: center; box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
h2 { color: #b71c1c; margin-top: 30px; }
.container { padding: 20px; max-width: 1200px; margin: auto; }
table { width: 100%; border-collapse: collapse; margin-bottom: 30px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); border-radius: 5px; overflow: hidden; }
th, td { border: 1px solid #b71c1c; padding: 8px; text-align: left; }
th { background: #fdd835; color: #4b2e2e; cursor: pointer; }
input, select { padding: 5px; margin: 5px 0; border: 1px solid #b71c1c; border-radius: 3px; }
button { background: #b71c1c; color: white; border: none; padding: 5px 10px; cursor: pointer; margin-right: 5px; border-radius: 3px; transition: 0.2s; }
button:hover:not(:disabled) { background: #d32f2f; }
button:disabled { background: #ccc; cursor: not-allowed; }
.editable { background: #fff8e1; cursor: text; transition: 0.2s; }
.editable:hover { border: 2px solid #fdd835; }
.editable:focus { outline: none; border: 2px solid #f57f17; background: #fff3e0; }
.hidden { display: none; }
.summary { margin-bottom: 20px; font-weight: bold; }
</style>
</head>
<body>
<header>
  <h1>Durga Puja Club Dashboard</h1>
  <div id="auth-section">
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Password">
    <button id="login-btn">Login</button>
    <button id="logout-btn" class="hidden">Logout</button>
    <span id="user-info"></span>
  </div>
</header>

<div class="container hidden" id="main-content">
  <div class="summary" id="summary-invitees"></div>
  <h2>Invitation List</h2>
  <input type="text" id="search-invite" placeholder="Search invitations...">
  <table id="invitation-table">
    <thead><tr><th>Name</th><th>Village</th><th>Mobile No</th><th>Remarks</th><th>Sent</th><th>Actions</th></tr></thead>
    <tbody></tbody>
  </table>
  <div id="invitation-form">
    <input type="text" id="inv-name" placeholder="Name">
    <input type="text" id="inv-village" placeholder="Village">
    <input type="text" id="inv-mobile" placeholder="Mobile No">
    <input type="text" id="inv-remarks" placeholder="Remarks">
    <button id="add-inv-btn">Add Invitation</button>
  </div>

  <div class="summary" id="summary-members"></div>
  <h2>Members List</h2>
  <input type="text" id="search-members" placeholder="Search members...">
  <table id="members-table">
    <thead><tr><th>Name</th><th>Village</th><th>Mobile No</th><th>Remarks</th><th>Actions</th></tr></thead>
    <tbody></tbody>
  </table>
  <div id="member-form">
    <input type="text" id="mem-name" placeholder="Name">
    <input type="text" id="mem-village" placeholder="Village">
    <input type="text" id="mem-mobile" placeholder="Mobile No">
    <input type="text" id="mem-remarks" placeholder="Remarks">
    <button id="add-mem-btn">Add Member</button>
  </div>

  <h2>Membership Fee Tracker (â‚¹100/month)</h2>
  <input type="text" id="search-fee" placeholder="Search member payments...">
  <table id="fee-table">
    <thead><tr><th>Member Name</th><th>Month</th><th>Amount</th><th>Status</th><th>Actions</th></tr></thead>
    <tbody></tbody>
  </table>
  <div id="fee-form">
    <input type="text" id="fee-member" placeholder="Member Name">
    <select id="fee-month">
      <option value="">Select Month</option>
      <option>January</option><option>February</option><option>March</option>
      <option>April</option><option>May</option><option>June</option>
      <option>July</option><option>August</option><option>September</option>
      <option>October</option><option>November</option><option>December</option>
    </select>
    <input type="number" id="fee-amount" value="100" min="0">
    <select id="fee-status">
      <option>Paid</option><option>Pending</option>
    </select>
    <button id="add-fee-btn">Add Record</button>
  </div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCuVs6jx7HiNIx25lzLgoq1B6nQqaHLHm0",
  authDomain: "guestandcollection.firebaseapp.com",
  projectId: "guestandcollection",
  storageBucket: "guestandcollection.firebasestorage.app",
  messagingSenderId: "272278233160",
  appId: "1:272278233160:web:d6d1e6a7d58be260d9b87d"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// Hardcoded roles
const roles = {
  "fRpLuiBgU0ZE1AtVmkGaA1RhBJk2": "admin",
  "898Fi5sPKHY01GUgI4iu1xS4TBR2": "viewer"
};
let currentRole = "viewer";

const loginBtn = document.getElementById("login-btn");
const logoutBtn = document.getElementById("logout-btn");
const userInfo = document.getElementById("user-info");
const mainContent = document.getElementById("main-content");

loginBtn.onclick = () => {
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;
  auth.signInWithEmailAndPassword(email, password).catch(err => alert(err.message));
};
logoutBtn.onclick = () => auth.signOut();

auth.onAuthStateChanged(user => {
  if (user) {
    currentRole = roles[user.uid] || "viewer";
    loginBtn.classList.add("hidden");
    logoutBtn.classList.remove("hidden");
    mainContent.classList.remove("hidden");
    userInfo.textContent = `${user.email} (${currentRole})`;
    applyRoleToUI();
    loadAllData();
  } else {
    loginBtn.classList.remove("hidden");
    logoutBtn.classList.add("hidden");
    mainContent.classList.add("hidden");
    userInfo.textContent = "";
  }
});

function applyRoleToUI(){
  const adminOnly = document.querySelectorAll("#add-inv-btn,#add-mem-btn,#add-col-btn,#add-fee-btn,.delete-btn");
  adminOnly.forEach(btn => btn.disabled = currentRole !== "admin");
}

// Firestore collections
const invitationCol = db.collection("invitations");
const membersCol = db.collection("members");
const feeCol = db.collection("membership_fees");

function loadAllData(){
  loadTable(invitationCol, "invitation-table", ["name","village","mobile","remarks","sent"], true);
  loadTable(membersCol, "members-table", ["name","village","mobile","remarks"], false);
  loadFeeTable();
}

function loadTable(colRef, tableId, fields, isInvite){
  const tbody=document.getElementById(tableId).querySelector("tbody");
  tbody.innerHTML="";
  colRef.get().then(snapshot=>{
    snapshot.forEach(doc=>{
      const data=doc.data();
      const tr=document.createElement("tr");
      fields.forEach(f=>{
        const td=document.createElement("td");
        td.textContent=data[f]||"";
        tr.appendChild(td);
      });
      tbody.appendChild(tr);
    });
  });
}

function loadFeeTable(){
  const tbody=document.getElementById("fee-table").querySelector("tbody");
  tbody.innerHTML="";
  feeCol.get().then(snapshot=>{
    snapshot.forEach(doc=>{
      const d=doc.data();
      const tr=document.createElement("tr");
      tr.innerHTML=`<td>${d.member}</td><td>${d.month}</td><td>${d.amount}</td><td>${d.status}</td>`;
      const td=document.createElement("td");
      const delBtn=document.createElement("button");
      delBtn.textContent="Delete";
      delBtn.disabled=currentRole!=="admin";
      delBtn.onclick=()=>{if(confirm("Delete record?"))doc.ref.delete().then(loadFeeTable);};
      td.appendChild(delBtn);
      tr.appendChild(td);
      tbody.appendChild(tr);
    });
  });
}

document.getElementById("add-fee-btn").onclick=()=>{
  const record={
    member:document.getElementById("fee-member").value,
    month:document.getElementById("fee-month").value,
    amount:Number(document.getElementById("fee-amount").value),
    status:document.getElementById("fee-status").value,
    dateAdded:new Date()
  };
  if(record.member && record.month){
    feeCol.add(record).then(()=>{
      ["fee-member","fee-month"].forEach(id=>document.getElementById(id).value="");
      document.getElementById("fee-amount").value=100;
      loadFeeTable();
    });
  } else alert("Please fill all details");
};

// Search
document.getElementById("search-fee").oninput=function(){filterTable("fee-table",this.value);}
function filterTable(tableId,term){
  const rows=document.getElementById(tableId).querySelectorAll("tbody tr");
  rows.forEach(tr=>{
    const text = tr.innerText.toLowerCase();
    tr.style.display = text.includes(term.toLowerCase()) ? "" : "none";
  });
}
</script>
</body>
</html>
