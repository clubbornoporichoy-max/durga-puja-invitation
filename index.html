<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Durga Puja Club Dashboard</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<style>
body { font-family: Arial; background: #fff5f0; color: #4b2e2e; margin: 0; padding: 0; }
header { background: #b71c1c; color: white; padding: 15px; text-align: center; box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
h2 { color: #b71c1c; margin-top: 30px; }
.container { padding: 20px; max-width: 1200px; margin: auto; }
table { width: 100%; border-collapse: collapse; margin-bottom: 30px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); border-radius: 5px; overflow: hidden; }
th, td { border: 1px solid #b71c1c; padding: 8px; text-align: left; }
th { background: #fdd835; color: #4b2e2e; cursor: pointer; }
input, select { padding: 5px; margin: 5px 0; border: 1px solid #b71c1c; border-radius: 3px; }
button { background: #b71c1c; color: white; border: none; padding: 5px 10px; cursor: pointer; margin-right: 5px; border-radius: 3px; transition: 0.2s; }
button:hover:not(:disabled) { background: #d32f2f; }
button:disabled { background: #ccc; cursor: not-allowed; }
.editable { background: #fff8e1; cursor: text; transition: 0.2s; }
.editable:hover { border: 2px solid #fdd835; }
.editable:focus { outline: none; border: 2px solid #f57f17; background: #fff3e0; }
.hidden { display: none; }
td { min-width: 80px; }
.summary { margin-bottom: 20px; font-weight: bold; }
.membership-table td, .membership-table th { font-size: 0.85em; text-align: center; }
.paid { background: #c8e6c9; }
.unpaid { background: #ffcdd2; }
</style>
</head>
<body>
<header>
  <h1>Durga Puja Club Dashboard</h1>
  <div id="auth-section">
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Password">
    <button id="login-btn">Login</button>
    <button id="logout-btn" class="hidden">Logout</button>
    <span id="user-info"></span>
  </div>
</header>

<div class="container hidden" id="main-content">

  <div class="summary" id="summary-invitees"></div>
  <h2>Invitation List</h2>
  <input type="text" id="search-invite" placeholder="Search invitations...">
  <table id="invitation-table">
    <thead><tr>
      <th>Name</th><th>Village</th><th>Mobile No</th><th>Remarks</th><th>Sent</th><th>Actions</th>
    </tr></thead>
    <tbody></tbody>
  </table>
  <div id="invitation-form">
    <input type="text" id="inv-name" placeholder="Name">
    <input type="text" id="inv-village" placeholder="Village">
    <input type="text" id="inv-mobile" placeholder="Mobile No">
    <input type="text" id="inv-remarks" placeholder="Remarks">
    <button id="add-inv-btn">Add Invitation</button>
  </div>

  <div class="summary" id="summary-members"></div>
  <h2>Members List</h2>
  <input type="text" id="search-members" placeholder="Search members...">
  <table id="members-table">
    <thead><tr><th>Name</th><th>Village</th><th>Mobile No</th><th>Remarks</th><th>Actions</th></tr></thead>
    <tbody></tbody>
  </table>
  <div id="member-form">
    <input type="text" id="mem-name" placeholder="Name">
    <input type="text" id="mem-village" placeholder="Village">
    <input type="text" id="mem-mobile" placeholder="Mobile No">
    <input type="text" id="mem-remarks" placeholder="Remarks">
    <button id="add-mem-btn">Add Member</button>
  </div>

  <h2>Donation Collectors</h2>
  <input type="text" id="search-collectors" placeholder="Search collectors...">
  <table id="collector-table">
    <thead><tr><th>Name</th><th>Assigned Area</th><th>Actions</th></tr></thead>
    <tbody></tbody>
  </table>
  <div id="collector-form">
    <input type="text" id="col-name" placeholder="Name">
    <input type="text" id="col-area" placeholder="Assigned Area">
    <button id="add-col-btn">Add Collector</button>
  </div>

  <h2>Membership Fee Tracker (₹100/month)</h2>
  <div class="summary" id="membership-summary"></div>
  <table id="membership-table" class="membership-table">
    <thead>
      <tr>
        <th>Member Name</th>
        <th>Jan</th><th>Feb</th><th>Mar</th><th>Apr</th><th>May</th><th>Jun</th>
        <th>Jul</th><th>Aug</th><th>Sep</th><th>Oct</th><th>Nov</th><th>Dec</th>
        <th>Total Paid (₹)</th><th>Pending (₹)</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCuVs6jx7HiNIx25lzLgoq1B6nQqaHLHm0",
  authDomain: "guestandcollection.firebaseapp.com",
  projectId: "guestandcollection",
  storageBucket: "guestandcollection.firebasestorage.app",
  messagingSenderId: "272278233160",
  appId: "1:272278233160:web:d6d1e6a7d58be260d9b87d"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

const roles = {
  "fRpLuiBgU0ZE1AtVmkGaA1RhBJk2": "admin",
  "898Fi5sPKHY01GUgI4iu1xS4TBR2": "viewer"
};
let currentRole = "viewer";

const loginBtn = document.getElementById("login-btn");
const logoutBtn = document.getElementById("logout-btn");
const userInfo = document.getElementById("user-info");
const mainContent = document.getElementById("main-content");

loginBtn.onclick = () => {
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;
  auth.signInWithEmailAndPassword(email, password).catch(err => alert(err.message));
};
logoutBtn.onclick = () => auth.signOut();

auth.onAuthStateChanged(user => {
  if(user){
    currentRole = roles[user.uid] || "viewer";
    loginBtn.classList.add("hidden");
    logoutBtn.classList.remove("hidden");
    mainContent.classList.remove("hidden");
    userInfo.textContent = `${user.email} (${currentRole})`;
    applyRoleToUI();
    loadAllData();
  } else {
    loginBtn.classList.remove("hidden");
    logoutBtn.classList.add("hidden");
    mainContent.classList.add("hidden");
    userInfo.textContent = "";
  }
});

function applyRoleToUI(){
  document.querySelectorAll("#add-inv-btn,#add-mem-btn,#add-col-btn").forEach(b=>b.disabled=currentRole!=="admin");
}

const invitationCol=db.collection("invitations");
const membersCol=db.collection("members");
const collectorsCol=db.collection("collectors");
const feesCol=db.collection("membershipFees");

function loadAllData(){
  loadTable(invitationCol,"invitation-table",["name","village","mobile","remarks","sent"],true);
  loadTable(membersCol,"members-table",["name","village","mobile","remarks"],false);
  loadTable(collectorsCol,"collector-table",["name","area"],false);
  loadMembershipTable();
}

// --- MEMBERSHIP FEES ---
const months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
function loadMembershipTable(){
  const tbody=document.querySelector("#membership-table tbody");
  tbody.innerHTML="";
  membersCol.get().then(membersSnap=>{
    let totalCollection=0,totalPending=0;
    membersSnap.forEach(mem=>{
      const data=mem.data();
      const tr=document.createElement("tr");
      const tdName=document.createElement("td");
      tdName.textContent=data.name;
      tr.appendChild(tdName);

      feesCol.doc(mem.id).get().then(feeSnap=>{
        let feeData=feeSnap.exists?feeSnap.data():{};
        let paidCount=0;
        months.forEach(m=>{
          const td=document.createElement("td");
          const chk=document.createElement("input");
          chk.type="checkbox";
          chk.checked=feeData[m]||false;
          chk.disabled=currentRole!=="admin";
          chk.onchange=()=>{
            feeData[m]=chk.checked;
            feesCol.doc(mem.id).set(feeData);
            loadMembershipTable();
          };
          td.appendChild(chk);
          td.className=chk.checked?"paid":"unpaid";
          tr.appendChild(td);
          if(chk.checked) paidCount++;
        });
        const paidAmt=paidCount*100;
        const pendingAmt=(12-paidCount)*100;
        totalCollection+=paidAmt;
        totalPending+=pendingAmt;
        const tdPaid=document.createElement("td");
        const tdPending=document.createElement("td");
        tdPaid.textContent=paidAmt;
        tdPending.textContent=pendingAmt;
        tr.appendChild(tdPaid);
        tr.appendChild(tdPending);
        tbody.appendChild(tr);
        document.getElementById("membership-summary").textContent=`Total Collection: ₹${totalCollection} | Pending: ₹${totalPending}`;
      });
    });
  });
}

// rest of your loadTable, addDocument, and search functions remain same from your existing code...
// (You can keep the same ones from your last working version)
</script>
</body>
</html>
